VERSION = 0.1
#CC = gcc
#LD = gcc

CC = clang
LD = clang

CFLAGS  = -g -O2 -Wall -DHAVE_CONFIG -DREALTIME_SCHEDULING -DVERSION=\"$(VERSION)\" -D_REENTRANT

LDFLAGS =  -ldl -lpthread -lm -lncurses

main.o server.o: CFLAGS += -DDEFAULT_PORT=3000

SRC = $(wildcard *.c)
obj = $(filter-out server.o mad.o nomad.o pulse.o, $(SRC:.c=.o))

libscmussrc = $(wildcard *.c)
libscmusobj = $(filter-out server.o main.o, $(SRC:.c=.o))

all: libscmus.a shared scmus

include lib.mk

scmus: $(obj)
	$(call cmd,ld,$(LDFLAGS))

shared: mad.so pulse.so

libscmus.a: $(libscmusobj)
	ar -crv $@ $^

mad.so: mad.o nomad.o
	$(CC) -DHAVE_CONFIG -shared -fPIC -o $@ $^ -lmad -ldl -L. -lscmus
	mkdir -p ./ip
	cp -f $@ ./ip/

pulse.so: pulse.o
	$(CC) -DHAVE_CONFIG -shared -fPIC -o $@ $^ -D_REENTRANT -lpulse -ldl -L. -lscmus
	mkdir -p ./op
	cp -f $@ ./op/

# remove files generated by make
clean: 
	rm -f *.o *.so *.a

realclean: clean
	rm -f scmus
	
.PHONY: all realclean clean
