VERSION = 0.1
#CC = gcc
#LD = gcc

CC = clang
LD = clang

CFLAGS  = -g -O2 -Wall -DHAVE_CONFIG -DREALTIME_SCHEDULING -DVERSION=\"$(VERSION)\" -D_REENTRANT

LDFLAGS =  -ldl -lpthread -lm -lncurses

main.o server.o: CFLAGS += -DDEFAULT_PORT=3000

SRC = $(wildcard *.c)
obj = $(filter-out server.o, $(SRC:.c=.o))

all: learn mad.so pulse.so clean

include lib.mk

learn: $(obj)
	$(call cmd,ld,$(LDFLAGS))

mad.so: mad.o nomad.o
	$(CC) -shared -o $@ $^ -lmad
	cp -f $@ ./ip/

pulse.so: pulse.o
	$(CC) -shared -o $@ $^ -D_REENTRANT -lpulse
	cp -f $@ ./op/

# remove files generated by make
clean: 
	rm -f *.o

# remove files generated by make and configure
distclean: clean learn
	rm -f $^

.PHONY: all realclean clean
